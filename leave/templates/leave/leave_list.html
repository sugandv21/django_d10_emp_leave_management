{% extends "leave/base.html" %}
{% block content %}
<div class="d-flex justify-content-between align-items-center mb-3">
  <h2>Leave Requests</h2>
  {% if not user.is_superuser %}
    <a href="{% url 'leave_create' %}" class="btn btn-primary">+ New Request</a>
  {% endif %}
</div>

<div class="table-responsive">
  <table class="table table-bordered table-hover align-middle">
    <thead class="table-light">
      <tr>
        <th>Employee</th>
        <th>Reason</th>
        <th>Status</th>
        <th>Submitted</th>
        <th>Actions</th>
      </tr>
    </thead>
    <tbody>
    {% for leave in leaves %}
      <tr>
        <td>{{ leave.employee.username }}</td>
        <td>{{ leave.reason }}</td>
        <td>
          <span class="badge 
            {% if leave.status == 'Pending' %}bg-warning text-dark
            {% elif leave.status == 'Approved' %}bg-success
            {% else %}bg-danger{% endif %}">
            {{ leave.status }}
          </span>
        </td>
        <td>{{ leave.created_at|date:"Y-m-d H:i" }}</td>
        <td>
          {# Employee: edit/delete own pending requests #}
          {% if user == leave.employee and leave.status == 'Pending' %}
            <a href="{% url 'leave_edit' leave.pk %}" class="btn btn-sm btn-info">Edit</a>
            <a href="{% url 'leave_delete' leave.pk %}" class="btn btn-sm btn-danger">Delete</a>
          {% endif %}

          {# Staff & Superuser: approve/reject #}
          {% if leave.status == 'Pending' %}
            {% if user.is_staff or user.is_superuser %}
              <a href="{% url 'leave_approve' leave.pk %}" class="btn btn-sm btn-success">Approve</a>
              <a href="{% url 'leave_reject' leave.pk %}" class="btn btn-sm btn-warning">Reject</a>
            {% endif %}
          {% endif %}

          {# Superuser: override delete #}
          {% if user.is_superuser %}
            <a href="{% url 'leave_override_delete' leave.pk %}" class="btn btn-sm btn-outline-danger">Super Delete</a>
          {% endif %}
        </td>
      </tr>
    {% empty %}
      <tr>
        <td colspan="5" class="text-center text-muted py-4">No leave requests found.</td>
      </tr>
    {% endfor %}
    </tbody>
  </table>
</div>
{% endblock %}
